version: {{docker.compose.version}}
services:
  sftp-source:
    image: springcloudstream/sftp-source-kafka:{{stream.apps.version}}
    environment:
      - SPRING_CLOUD_FUNCTION_DEFINITION={{functionDefinition}}
      - FILE_CONSUMER_MODE={{consumerMode}}
      - SFTP_SUPPLIER_FACTORY_ALLOW_UNKNOWN_KEYS=true
      - SFTP_SUPPLIER_REMOTE_DIR=/remote
      - SFTP_SUPPLIER_FACTORY_USERNAME=user
      - SFTP_SUPPLIER_FACTORY_PASSWORD=pass
      - SFTP_SUPPLIER_FACTORY_HOST=sftp
      - SFTP_SUPPLIER_FACTORY_PORT={{sftpPort}}
      - SFTP_SUPPLIER_LIST_ONLY={{listOnly}}
      - SPRING_CLOUD_STREAM_BINDINGS_OUTPUT_DESTINATION=log
      - SPRING_CLOUD_STREAM_KAFKA_BINDER_BROKERS={{kafkaBootStrapServers}}
# For Task Launch Request
      - TASK_LAUNCH_REQUEST_ARG_EXPRESSIONS=filename=payload
      - TASK_LAUNCH_REQUEST_TASK_NAME=myTask
    extra_hosts:
      - sftp:{{sftpHost}}
  log-sink:
    image: springcloudstream/log-sink-kafka:{{stream.apps.version}}
    environment:
      - SPRING_CLOUD_STREAM_KAFKA_BINDER_BROKERS={{kafkaBootStrapServers}}
      - SPRING_CLOUD_STREAM_BINDINGS_INPUT_DESTINATION=log
      - SPRING_CLOUD_STREAM_BINDINGS_INPUT_GROUP=sftp-source-tests